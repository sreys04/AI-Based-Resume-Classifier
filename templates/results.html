<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Results - Resume Classifier AI</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="nav">
                <div class="logo">
                    <i class="fas fa-robot"></i>
                    <span>Resume Classifier AI</span>
                </div>
                <nav class="navigation">
                    <a href="/" class="nav-link">Home</a>
                    <a href="/upload" class="nav-link">Upload</a>
                    <a href="/results" class="nav-link active">Results</a>
                </nav>
            </div>
        </div>
    </header>

    <main class="main">
        <section class="results-section" style="padding: 60px 0;">
            <div class="container">
                <div class="results-header" style="text-align: center; margin-bottom: 50px;">
                    <h1>Classification Results</h1>
                    <p>View all resume classification results and statistics</p>
                </div>

                <div class="results-container" style="max-width: 1200px; margin: 0 auto;">
                    <!-- Statistics Cards -->
                    <div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 30px; margin-bottom: 50px;">
                        <div class="stat-card" style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); text-align: center;">
                            <i class="fas fa-file-alt" style="font-size: 2.5rem; color: #667eea; margin-bottom: 15px;"></i>
                            <h3 id="total-resumes" style="font-size: 2rem; margin-bottom: 10px; color: #333;">-</h3>
                            <p style="color: #666;">Total Resumes</p>
                        </div>
                        <div class="stat-card" style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); text-align: center;">
                            <i class="fas fa-check-circle" style="font-size: 2.5rem; color: #28a745; margin-bottom: 15px;"></i>
                            <h3 id="completed-resumes" style="font-size: 2rem; margin-bottom: 10px; color: #333;">-</h3>
                            <p style="color: #666;">Completed Classifications</p>
                        </div>
                        <div class="stat-card" style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); text-align: center;">
                            <i class="fas fa-chart-pie" style="font-size: 2.5rem; color: #ffc107; margin-bottom: 15px;"></i>
                            <h3 id="top-category" style="font-size: 1.2rem; margin-bottom: 10px; color: #333;">-</h3>
                            <p style="color: #666;">Most Common Category</p>
                        </div>
                    </div>

                    <!-- Filters -->
                    <div class="filters" style="background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); margin-bottom: 30px;">
                        <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap;">
                            <label>
                                <span style="margin-right: 10px; font-weight: 500;">Category:</span>
                                <select id="category-filter" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 8px;">
                                    <option value="">All Categories</option>
                                </select>
                            </label>
                            <label>
                                <span style="margin-right: 10px; font-weight: 500;">Status:</span>
                                <select id="status-filter" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 8px;">
                                    <option value="">All Status</option>
                                    <option value="completed">Completed</option>
                                    <option value="processing">Processing</option>
                                    <option value="error">Error</option>
                                </select>
                            </label>
                            <button id="refresh-btn" class="btn btn-secondary" style="margin-left: auto;">
                                <i class="fas fa-sync-alt"></i>
                                Refresh
                            </button>
                        </div>
                    </div>

                    <!-- Results Table -->
                    <div class="results-table" style="background: white; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); overflow: hidden;">
                        <div class="table-header" style="background: #f8f9fa; padding: 20px; border-bottom: 1px solid #dee2e6;">
                            <h3 style="margin: 0; color: #333;">Recent Classifications</h3>
                        </div>
                        
                        <div id="loading-indicator" style="text-align: center; padding: 50px; display: none;">
                            <i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: #667eea;"></i>
                            <p style="margin-top: 15px; color: #666;">Loading results...</p>
                        </div>

                        <div id="results-list" style="max-height: 600px; overflow-y: auto;">
                            <!-- Results will be loaded here -->
                        </div>

                        <div id="no-results" style="text-align: center; padding: 50px; display: none;">
                            <i class="fas fa-inbox" style="font-size: 3rem; color: #ccc; margin-bottom: 20px;"></i>
                            <p style="color: #666; font-size: 1.2rem;">No results found</p>
                            <a href="/upload" class="btn btn-primary" style="margin-top: 20px;">
                                <i class="fas fa-upload"></i>
                                Upload Resume
                            </a>
                        </div>
                    </div>

                    <!-- Pagination -->
                    <div id="pagination" style="display: flex; justify-content: center; margin-top: 30px; gap: 10px;">
                        <!-- Pagination buttons will be added here -->
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <p>&copy; 2025 Resume Classifier AI. Built with ❤️ for efficient resume processing.</p>
            </div>
        </div>
    </footer>

    <script>
        // Results page functionality
        class ResultsManager {
            constructor() {
                this.currentPage = 1;
                this.totalPages = 1;
                this.initializeElements();
                this.attachEventListeners();
                this.loadInitialData();
            }

            initializeElements() {
                this.categoryFilter = document.getElementById('category-filter');
                this.statusFilter = document.getElementById('status-filter');
                this.refreshBtn = document.getElementById('refresh-btn');
                this.loadingIndicator = document.getElementById('loading-indicator');
                this.resultsList = document.getElementById('results-list');
                this.noResults = document.getElementById('no-results');
                this.pagination = document.getElementById('pagination');
                this.totalResumes = document.getElementById('total-resumes');
                this.completedResumes = document.getElementById('completed-resumes');
                this.topCategory = document.getElementById('top-category');
            }

            attachEventListeners() {
                this.refreshBtn.addEventListener('click', () => this.loadResults());
                this.categoryFilter.addEventListener('change', () => this.loadResults());
                this.statusFilter.addEventListener('change', () => this.loadResults());
            }

            async loadInitialData() {
                await this.loadCategories();
                await this.loadStats();
                await this.loadResults();
            }

            async loadCategories() {
                try {
                    const response = await fetch('/api/categories');
                    const data = await response.json();
                    
                    data.categories.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category;
                        option.textContent = category;
                        this.categoryFilter.appendChild(option);
                    });
                } catch (error) {
                    console.error('Error loading categories:', error);
                }
            }

            async loadStats() {
                try {
                    const response = await fetch('/api/stats');
                    const data = await response.json();
                    
                    this.totalResumes.textContent = data.total_resumes;
                    this.completedResumes.textContent = data.completed_resumes;
                    
                    // Find top category
                    const categories = data.category_distribution;
                    let topCat = 'None';
                    let maxCount = 0;
                    
                    for (const [category, count] of Object.entries(categories)) {
                        if (count > maxCount) {
                            maxCount = count;
                            topCat = category;
                        }
                    }
                    
                    this.topCategory.textContent = topCat;
                } catch (error) {
                    console.error('Error loading stats:', error);
                }
            }

            async loadResults(page = 1) {
                this.showLoading();
                
                try {
                    const params = new URLSearchParams({
                        page: page,
                        per_page: 10
                    });

                    const response = await fetch(`/api/results?${params}`);
                    const data = await response.json();
                    
                    this.currentPage = page;
                    this.totalPages = data.pages;
                    
                    this.displayResults(data.resumes);
                    this.updatePagination();
                    
                } catch (error) {
                    console.error('Error loading results:', error);
                    this.showError('Failed to load results');
                }
            }

            showLoading() {
                this.loadingIndicator.style.display = 'block';
                this.resultsList.style.display = 'none';
                this.noResults.style.display = 'none';
            }

            displayResults(resumes) {
                this.loadingIndicator.style.display = 'none';
                
                if (!resumes || resumes.length === 0) {
                    this.noResults.style.display = 'block';
                    this.resultsList.style.display = 'none';
                    return;
                }

                this.noResults.style.display = 'none';
                this.resultsList.style.display = 'block';
                this.resultsList.innerHTML = '';

                resumes.forEach(resume => {
                    const resumeItem = this.createResumeItem(resume);
                    this.resultsList.appendChild(resumeItem);
                });
            }

            createResumeItem(resume) {
                const item = document.createElement('div');
                item.style.cssText = 'padding: 20px; border-bottom: 1px solid #eee; transition: background 0.2s;';
                
                const statusColor = {
                    'completed': '#28a745',
                    'processing': '#ffc107',
                    'error': '#dc3545'
                }[resume.status] || '#6c757d';

                const confidence = resume.confidence_score ? Math.round(resume.confidence_score * 100) + '%' : 'N/A';
                
                item.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: start; gap: 20px;">
                        <div style="flex: 1;">
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
                                <i class="fas fa-file-alt" style="color: #667eea; font-size: 1.2rem;"></i>
                                <h4 style="margin: 0; color: #333; font-size: 1.1rem;">${resume.original_filename}</h4>
                                <span style="background: ${statusColor}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem; text-transform: capitalize;">
                                    ${resume.status}
                                </span>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 10px;">
                                <div>
                                    <span style="color: #666; font-size: 0.9rem;">Category:</span>
                                    <div style="font-weight: 500; color: #333;">${resume.predicted_category || 'Not classified'}</div>
                                </div>
                                <div>
                                    <span style="color: #666; font-size: 0.9rem;">Confidence:</span>
                                    <div style="font-weight: 500; color: #333;">${confidence}</div>
                                </div>
                                <div>
                                    <span style="color: #666; font-size: 0.9rem;">Upload Date:</span>
                                    <div style="font-weight: 500; color: #333;">${this.formatDate(resume.upload_timestamp)}</div>
                                </div>
                                <div>
                                    <span style="color: #666; font-size: 0.9rem;">Processing Time:</span>
                                    <div style="font-weight: 500; color: #333;">${this.formatProcessingTime(resume.processing_time)}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                item.addEventListener('mouseenter', () => {
                    item.style.background = '#f8f9fa';
                });
                
                item.addEventListener('mouseleave', () => {
                    item.style.background = 'white';
                });

                return item;
            }

            updatePagination() {
                this.pagination.innerHTML = '';
                
                if (this.totalPages <= 1) return;

                // Previous button
                if (this.currentPage > 1) {
                    const prevBtn = this.createPaginationButton('Previous', this.currentPage - 1);
                    this.pagination.appendChild(prevBtn);
                }

                // Page numbers
                for (let i = Math.max(1, this.currentPage - 2); i <= Math.min(this.totalPages, this.currentPage + 2); i++) {
                    const pageBtn = this.createPaginationButton(i, i, i === this.currentPage);
                    this.pagination.appendChild(pageBtn);
                }

                // Next button
                if (this.currentPage < this.totalPages) {
                    const nextBtn = this.createPaginationButton('Next', this.currentPage + 1);
                    this.pagination.appendChild(nextBtn);
                }
            }

            createPaginationButton(text, page, isActive = false) {
                const btn = document.createElement('button');
                btn.textContent = text;
                btn.style.cssText = `
                    padding: 10px 15px;
                    border: 1px solid #ddd;
                    background: ${isActive ? '#667eea' : 'white'};
                    color: ${isActive ? 'white' : '#333'};
                    border-radius: 8px;
                    cursor: pointer;
                    transition: all 0.2s;
                `;

                if (!isActive) {
                    btn.addEventListener('mouseenter', () => {
                        btn.style.background = '#f8f9fa';
                    });
                    btn.addEventListener('mouseleave', () => {
                        btn.style.background = 'white';
                    });
                }

                btn.addEventListener('click', () => this.loadResults(page));
                return btn;
            }

            formatDate(timestamp) {
                if (!timestamp) return 'N/A';
                return new Date(timestamp).toLocaleDateString();
            }

            formatProcessingTime(time) {
                if (!time) return 'N/A';
                return time.toFixed(2) + 's';
            }

            showError(message) {
                this.loadingIndicator.style.display = 'none';
                this.resultsList.innerHTML = `
                    <div style="text-align: center; padding: 50px;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: #dc3545; margin-bottom: 20px;"></i>
                        <p style="color: #666; font-size: 1.2rem;">${message}</p>
                    </div>
                `;
                this.resultsList.style.display = 'block';
                this.noResults.style.display = 'none';
            }
        }

        // Initialize results manager
        document.addEventListener('DOMContentLoaded', () => {
            new ResultsManager();
        });
    </script>
</body>
</html>